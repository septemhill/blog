<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><title data-next-head="">Reflection</title><meta name="description" content="Septem / Full Stack Engineer" data-next-head=""/><meta property="og:title" content="Reflection" data-next-head=""/><meta property="og:description" content="Septem / Full Stack Engineer" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta property="og:url" content="https://your-domain.com" data-next-head=""/><meta property="og:image" content="https://your-domain.com/ogp.png" data-next-head=""/><meta property="og:site_name" content="Reflection" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:title" content="Reflection" data-next-head=""/><meta name="twitter:description" content="Septem / Full Stack Engineer" data-next-head=""/><meta name="twitter:image" content="https://your-domain.com/ogp.png" data-next-head=""/><link rel="canonical" href="https://your-domain.com" data-next-head=""/><link rel="preload" href="/blog/_next/static/chunks/be05223f99e5e066.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/chunks/be05223f99e5e066.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/blog/_next/static/chunks/b4c32c0cdfd0fb50.js" defer=""></script><script src="/blog/_next/static/chunks/0b2c3c71682164fc.js" defer=""></script><script src="/blog/_next/static/chunks/5708d5cc1219ecce.js" defer=""></script><script src="/blog/_next/static/chunks/1fc4b3891fe5a98a.js" defer=""></script><script src="/blog/_next/static/chunks/turbopack-dd71b13b56b2b247.js" defer=""></script><script src="/blog/_next/static/chunks/1e9770ae1f2cdb24.js" defer=""></script><script src="/blog/_next/static/chunks/turbopack-a5fc1d61e9323c9e.js" defer=""></script><script src="/blog/_next/static/6Y5iuvZSdKsJlHAZHDIoi/_ssgManifest.js" defer=""></script><script src="/blog/_next/static/6Y5iuvZSdKsJlHAZHDIoi/_buildManifest.js" defer=""></script></head><body class="antialiased"><div id="__next"><header class="fixed top-0 left-0 w-full bg-white shadow-md z-50"><nav class="container mx-auto px-6 py-4"><div class="flex items-center justify-between"><a class="text-xl font-bold text-gray-800 hover:text-gray-700" href="/blog">Reflection</a><div class="flex space-x-4"><a class="text-gray-600 hover:text-blue-500" href="/blog">Home</a><a class="text-gray-600 hover:text-blue-500" href="/blog/about">About</a></div></div></nav></header><main class="pt-20"><div class="container mx-auto px-4 py-8"><article><h1 class="text-4xl font-bold mb-2">Defer Statement</h1><div class="text-gray-500 mb-4">2025-10-14</div><div class="mb-4"><a class="text-sm bg-gray-200 text-gray-800 px-2 py-1 rounded-full mr-2 hover:bg-gray-300" href="/blog/tags/defer">defer</a><a class="text-sm bg-gray-200 text-gray-800 px-2 py-1 rounded-full mr-2 hover:bg-gray-300" href="/blog/tags/C">C</a><a class="text-sm bg-gray-200 text-gray-800 px-2 py-1 rounded-full mr-2 hover:bg-gray-300" href="/blog/tags/llvm">llvm</a><a class="text-sm bg-gray-200 text-gray-800 px-2 py-1 rounded-full mr-2 hover:bg-gray-300" href="/blog/tags/gcc">gcc</a></div><div class="prose max-w-none"><p>前幾天晚上在看 Google 推播的一些文章，裡面包含了一個 llvm-project 的 <a href="https://github.com/llvm/llvm-project/pull/162848" class="text-blue-500 hover:underline" target="_blank" rel="noopener noreferrer">PR</a>。<br>
我還蠻訝異的，這個在 C 中新增 defer statement 的提案，其實已經很多年了。<br>
當年從 C 換去寫 Go 之後，一直覺得 defer 這東西真的很好用。<br>
後來也看到相關的 C 提案，只是一直都沒有實作的消息，一直到現在。<br>
然後突然想到，既然 llvm 都支援了， gcc 應該也會支援吧。<br>
於是查了一下，確實也有相關的 <a href="https://patchwork.ozlabs.org/project/gcc/list/?series=467675" class="text-blue-500 hover:underline" target="_blank" rel="noopener noreferrer">patches</a> 正在等待 review。</p>
<br>
<p>終於，以前為了解決 memory release 到處 goto 的問題，應該可以稍微減少一點了。<br>
不過，要等到 kernel / driver 會普遍大量使用，我覺得還有一段路要走吧。<br>
更何況，也不見得會為了這個 defer statement 回頭去做 refactor。<br>
畢竟軟體業界最常說的就是：「If it works, don't touch it」。</p></div></article><div class="mt-8"><a class="text-blue-600 hover:underline" href="/blog">← Back to home</a></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"c-defer-stmt","contentHtml":"\u003cp\u003e前幾天晚上在看 Google 推播的一些文章，裡面包含了一個 llvm-project 的 \u003ca href=\"https://github.com/llvm/llvm-project/pull/162848\" class=\"text-blue-500 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePR\u003c/a\u003e。\u003cbr\u003e\n我還蠻訝異的，這個在 C 中新增 defer statement 的提案，其實已經很多年了。\u003cbr\u003e\n當年從 C 換去寫 Go 之後，一直覺得 defer 這東西真的很好用。\u003cbr\u003e\n後來也看到相關的 C 提案，只是一直都沒有實作的消息，一直到現在。\u003cbr\u003e\n然後突然想到，既然 llvm 都支援了， gcc 應該也會支援吧。\u003cbr\u003e\n於是查了一下，確實也有相關的 \u003ca href=\"https://patchwork.ozlabs.org/project/gcc/list/?series=467675\" class=\"text-blue-500 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\"\u003epatches\u003c/a\u003e 正在等待 review。\u003c/p\u003e\n\u003cbr\u003e\n\u003cp\u003e終於，以前為了解決 memory release 到處 goto 的問題，應該可以稍微減少一點了。\u003cbr\u003e\n不過，要等到 kernel / driver 會普遍大量使用，我覺得還有一段路要走吧。\u003cbr\u003e\n更何況，也不見得會為了這個 defer statement 回頭去做 refactor。\u003cbr\u003e\n畢竟軟體業界最常說的就是：「If it works, don't touch it」。\u003c/p\u003e","title":"Defer Statement","date":"2025-10-14","tags":["defer","C","llvm","gcc"],"time":"10:00:00"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"c-defer-stmt"},"buildId":"6Y5iuvZSdKsJlHAZHDIoi","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>